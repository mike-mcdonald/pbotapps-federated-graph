name: Build image
description: Build and push docker image to specified repository
inputs:
  directory:
    description: 'Which service to build'
    required: true
  artifact-name:
    description: What name to give your artifact

runs:
  using: 'composite'
  steps:
    - name: install dependencies
      shell: bash
      run: pnpm
    - name: Run docker build
      shell: bash
      run: |
        docker \
        build \
        --file .docker/Dockerfile \
        --build-arg WORKDIR=${{ inputs.directory }} \
        --output type=tar,dest=${{ github.sha }}.tar \
        .
    - name: Upload build
      uses: actions/upload-artifact@v3
      with:
        name: ${{ inputs.artifact-name }}
        path: ${{ github.sha }}.tar
